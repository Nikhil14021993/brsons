<!DOCTYPE html>
<html>
<head>
    <title>Test Voucher Accounts</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Test Voucher Accounts Loading</h1>
    
    <div class="test-section">
        <h3>Test 1: Check Debug Endpoint</h3>
        <button onclick="testDebugEndpoint()">Test /admin/vouchers/debug-accounts</button>
        <div id="debugResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Check Voucher Form</h3>
        <button onclick="testVoucherForm()">Test /admin/vouchers/new</button>
        <div id="voucherResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Manual Account Check</h3>
        <button onclick="checkAccounts()">Check Accounts in Console</button>
        <div id="manualResult" class="result">Check browser console for results</div>
    </div>

    <script>
        function testDebugEndpoint() {
            fetch('/admin/vouchers/debug-accounts')
                .then(response => {
                    console.log('Debug endpoint response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Debug endpoint data:', data);
                    document.getElementById('debugResult').innerHTML = 
                        '<strong>Success!</strong> Found ' + data.length + ' accounts: ' + 
                        JSON.stringify(data.map(acc => acc.name));
                })
                .catch(error => {
                    console.error('Debug endpoint error:', error);
                    document.getElementById('debugResult').innerHTML = 
                        '<strong>Error:</strong> ' + error.message;
                });
        }
        
        function testVoucherForm() {
            fetch('/admin/vouchers/new')
                .then(response => response.text())
                .then(html => {
                    console.log('Voucher form response received');
                    // Look for accounts in the HTML
                    const accountsMatch = html.match(/const accounts = (\[.*?\]);/);
                    if (accountsMatch) {
                        try {
                            const accounts = JSON.parse(accountsMatch[1]);
                            console.log('Accounts found in voucher form:', accounts);
                            document.getElementById('voucherResult').innerHTML = 
                                '<strong>Success!</strong> Found ' + accounts.length + ' accounts in voucher form';
                        } catch (e) {
                            console.error('Error parsing accounts:', e);
                            document.getElementById('voucherResult').innerHTML = 
                                '<strong>Error parsing accounts:</strong> ' + e.message;
                        }
                    } else {
                        document.getElementById('voucherResult').innerHTML = 
                            '<strong>No accounts found</strong> in voucher form HTML';
                    }
                })
                .catch(error => {
                    console.error('Voucher form error:', error);
                    document.getElementById('voucherResult').innerHTML = 
                        '<strong>Error:</strong> ' + error.message;
                });
        }
        
        function checkAccounts() {
            console.log('=== MANUAL ACCOUNT CHECK ===');
            console.log('1. Check if application is running on http://localhost:8085');
            console.log('2. Check if you are logged in as Admin');
            console.log('3. Check browser network tab for any errors');
            console.log('4. Check application logs for account loading messages');
            console.log('============================');
        }
    </script>
</body>
</html>
