<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Product</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body { 
            font-family: Arial; 
            background: #f4f6f8; 
            margin: 0;
        }
        .form-container {
            max-width: 800px;
            background: white; 
            padding: 30px; 
            margin: 50px auto;
            border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .form-row.full {
            grid-template-columns: 1fr;
        }
        label { 
            display: block; 
            margin-top: 10px; 
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%; 
            padding: 10px; 
            margin-top: 5px;
            border: 1px solid #ddd; 
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        button { 
            margin-top: 15px; 
            padding: 12px 24px;
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .variants-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .variants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .add-variant-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        .add-variant-btn:hover {
            background: #218838;
        }
        .variant-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            align-items: end;
        }
        .variant-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            flex: 1;
        }
        .variant-fabric { background: #e3f2fd; }
        .variant-style { background: #f3e5f5; }
        .variant-size { background: #e8f5e8; }
        .variant-pattern { background: #fff3e0; }
        .variant-care { background: #fce4ec; }
        .variant-occasion { background: #f1f8e9; }
        .remove-variant-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            height: fit-content;
        }
        .remove-variant-btn:hover {
            background: #c82333;
        }
        .image-preview {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-top: 4px;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .variant-inputs {
                grid-template-columns: 1fr 1fr;
            }
            .variant-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
    <script>
    function toggleNewCategory(select) {
        var input = document.getElementById("newCategoryInput");
        input.style.display = (select.value === 'Other') ? 'block' : 'none';
        if (select.value === 'Other') {
            input.setAttribute("required", "true");
        } else {
            input.removeAttribute("required");
        }
    }

    function addVariant() {
        const container = document.getElementById('variants-container');
        const variantRow = document.createElement('div');
        variantRow.className = 'variant-row';
        variantRow.innerHTML = `
            <div class="variant-inputs">
                <div class="variant-fabric">
                    <label>Fabric:</label>
                    <input type="text" name="variantFabrics" placeholder="e.g., Cotton, Denim">
                </div>
                <div class="variant-style">
                    <label>Style:</label>
                    <input type="text" name="variantStyles" placeholder="e.g., Casual, Formal">
                </div>
                <div class="variant-size">
                    <label>Size:</label>
                    <input type="text" name="variantSizes" placeholder="e.g., S, M, L">
                </div>
                <div class="variant-pattern">
                    <label>Pattern:</label>
                    <input type="text" name="variantPatterns" placeholder="e.g., Solid, Striped">
                </div>
                <div class="variant-care">
                    <label>Care Instruction:</label>
                    <input type="text" name="variantCareInstructions" placeholder="e.g., Hand wash">
                </div>
                <div class="variant-occasion">
                    <label>Occasion:</label>
                    <input type="text" name="variantOccasions" placeholder="e.g., Party, Casual">
                </div>
            </div>
            <button type="button" class="remove-variant-btn" onclick="removeVariant(this)">Remove</button>
        `;
        container.appendChild(variantRow);
    }

    function removeVariant(button) {
        button.parentElement.remove();
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Tax Configuration Helper Functions
        const cgstInput = document.querySelector('input[name="cgstPercentage"]');
        const sgstInput = document.querySelector('input[name="sgstPercentage"]');
        const igstInput = document.querySelector('input[name="igstPercentage"]');

        // Auto-sync CGST and SGST (they should typically be equal)
        if (cgstInput && sgstInput) {
            cgstInput.addEventListener('input', function() {
                const cgstValue = parseFloat(this.value) || 0;
                if (cgstValue > 0) {
                    sgstInput.value = cgstValue.toFixed(2);
                    // Auto-calculate IGST as sum of CGST + SGST
                    if (igstInput) {
                        igstInput.value = (cgstValue * 2).toFixed(2);
                    }
                }
            });

            sgstInput.addEventListener('input', function() {
                const sgstValue = parseFloat(this.value) || 0;
                if (sgstValue > 0) {
                    cgstInput.value = sgstValue.toFixed(2);
                    // Auto-calculate IGST as sum of CGST + SGST
                    if (igstInput) {
                        igstInput.value = (sgstValue * 2).toFixed(2);
                    }
                }
            });
        }

        // IGST auto-calculation helper
        if (igstInput && cgstInput && sgstInput) {
            igstInput.addEventListener('input', function() {
                const igstValue = parseFloat(this.value) || 0;
                if (igstValue > 0) {
                    // Split IGST equally between CGST and SGST
                    const halfIgst = (igstValue / 2).toFixed(2);
                    cgstInput.value = halfIgst;
                    sgstInput.value = halfIgst;
                }
            });
        }

        const fileInputs = [
            { input: document.querySelector('input[name="imageFile1"]'), label: "Image 1" },
            { input: document.querySelector('input[name="imageFile2"]'), label: "Image 2" },
            { input: document.querySelector('input[name="imageFile3"]'), label: "Image 3" },
            { input: document.querySelector('input[name="imageFile4"]'), label: "Image 4" },
            { input: document.querySelector('input[name="imageFile5"]'), label: "Image 5" }
        ];
        const mainPhotoSelect = document.getElementById("mainPhotoSelect");

        function updateMainPhotoOptions() {
            mainPhotoSelect.innerHTML = '<option value="">-- Select Main Photo --</option>';
            fileInputs.forEach(({ input, label }) => {
                if (input.files.length > 0) {
                    const fileName = input.files[0].name;
                    const option = document.createElement("option");
                    option.value = fileName;
                    option.textContent = `${label} (${fileName})`;
                    mainPhotoSelect.appendChild(option);
                }
            });
        }

        fileInputs.forEach(({ input }) => {
            input.addEventListener("change", updateMainPhotoOptions);
        });
    });
    </script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-logo">Cloth Shop</div>
    <ul class="navbar-links">
      <li><a th:href="@{/}">Home</a></li>
       <!-- Show Admin button only if logged-in user type is Admin -->
    <li th:if="${session.user != null and session.user.type == 'Admin'}">
        <a th:href="@{/admin}">Admin</a>
    </li>
      <li><a th:href="@{/shop}">Shop</a></li>
      <li th:if="${session.user != null}">
  <a th:href="@{/orders}">Orders</a>
</li>
      <li><a href="#">Services</a></li>
      <li><a href="#">Pricing</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">Contact Us</a></li>
      
      <!-- Dynamic Login/Logout -->
    <li th:if="${session.user == null}"><a th:href="@{/login}">Login</a></li>
    <li th:if="${session.user != null}"><a th:href="@{/logout}">Logout</a></li>
      
    </ul>
  </nav>

    <div class="form-container">
        <h2>Add Product</h2>
        <form th:action="@{/admin/add-product}" th:object="${product}" method="post" enctype="multipart/form-data">

            <div class="form-row">
                <div>
                    <label>Category:</label>
                    <select name="selectedCategory" onchange="toggleNewCategory(this)" required>
                        <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.categoryName}"></option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <input type="text" name="newCategoryName" id="newCategoryInput" style="display:none;" placeholder="Enter new category name">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Product Name:</label>
                    <input type="text" th:field="*{productName}" required>
                </div>
                <div>
                    <label>Status:</label>
                    <select th:field="*{status}" required>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Out of Stock">Out of Stock</option>
                    </select>
                </div>
            </div>

            <div class="form-row full">
                <div>
                    <label>Description:</label>
                    <textarea th:field="*{description}" placeholder="Enter product description..."></textarea>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Retail Price:</label>
                    <input type="number" step="0.01" th:field="*{retailPrice}" required>
                </div>
                <div>
                    <label>Purchase Price:</label>
                    <input type="number" step="0.01" th:field="*{purchasePrice}" placeholder="Cost price from supplier">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>B2B Price:</label>
                    <input type="number" step="0.01" th:field="*{b2bPrice}" placeholder="Enter wholesale price">
                </div>
                <div>
                    <label>B2B Minimum Quantity:</label>
                    <input type="number" th:field="*{b2bMinQuantity}" placeholder="1" min="1">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Discount (%):</label>
                    <input type="number" step="0.01" th:field="*{discount}" placeholder="0.0">
                </div>
                <div>
                    <label>Stock Quantity:</label>
                    <input type="number" th:field="*{stockQuantity}" placeholder="0">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>HSN Code:</label>
                    <input type="text" name="hsnCode" placeholder="Enter HSN Code">
                </div>
            </div>

            <!-- Tax Configuration Section -->
            <div class="form-row full" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #28a745;">
                <div>
                    <h4 style="margin: 0 0 15px 0; color: #28a745;">
                        <i class="fas fa-percentage"></i> Tax Configuration
                    </h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
                        Define tax percentages for this product. Admin can set CGST, SGST, and IGST rates.
                        The appropriate tax will be applied based on customer's location.
                    </p>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>CGST % (Central GST):</label>
                    <input type="number" step="0.01" th:field="*{cgstPercentage}" 
                           placeholder="e.g., 9.00" min="0" max="50">
                    <small style="color: #666;">For intra-state transactions</small>
                </div>
                <div>
                    <label>SGST % (State GST):</label>
                    <input type="number" step="0.01" th:field="*{sgstPercentage}" 
                           placeholder="e.g., 9.00" min="0" max="50">
                    <small style="color: #666;">For intra-state transactions</small>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>IGST % (Integrated GST):</label>
                    <input type="number" step="0.01" th:field="*{igstPercentage}" 
                           placeholder="e.g., 18.00" min="0" max="50">
                    <small style="color: #666;">For inter-state transactions</small>
                </div>
                <div>
                    <!-- Empty div for spacing -->
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 1 (Mandatory):</label>
                    <input type="file" name="imageFile1" accept="image/*" required>
                    <div id="previewImage1" style="margin-top:8px;"></div>
                </div>
            </div>

            <!-- Pricing Information -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #17a2b8;">
                <h4 style="margin: 0 0 10px 0; color: #17a2b8;">
                    <i class="fas fa-info-circle"></i> Pricing Structure Guide
                </h4>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                    <li><strong>Purchase Price:</strong> Cost price from supplier (typically 60% of retail price)</li>
                    <li><strong>Retail Price:</strong> Selling price to end customers</li>
                    <li><strong>B2B Price:</strong> Wholesale price for business customers (set manually)</li>
                    <li><strong>B2B Minimum Quantity:</strong> Minimum quantity B2B customers must order (e.g., 3, 5, 10)</li>
                    <li><strong>Profit Margin:</strong> Retail price should be at least 1.67x purchase price for healthy margins</li>
                </ul>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 2:</label>
                    <input type="file" name="imageFile2" accept="image/*">
                    <div id="previewImage2" style="margin-top:8px;"></div>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 3:</label>
                    <input type="file" name="imageFile3" accept="image/*">
                    <div id="previewImage3" style="margin-top:8px;"></div>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 4:</label>
                    <input type="file" name="imageFile4" accept="image/*">
                    <div id="previewImage4" style="margin-top:8px;"></div>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 5:</label>
                    <input type="file" name="imageFile5" accept="image/*">
                    <div id="previewImage5" style="margin-top:8px;"></div>
                </div>
                <div>
                    <label>Main Photo:</label>
                    <select name="mainPhoto" id="mainPhotoSelect" required>
                        <option value="">-- Select Main Photo --</option>
                    </select>
                </div>
            </div>

            <!-- Product Variants Section -->
            <div class="variants-section">
                <div class="variants-header">
                    <h3>Product Variants</h3>
                    <button type="button" class="add-variant-btn" onclick="addVariant()">Add Another Variant</button>
                </div>
                <p style="color: #666; margin-bottom: 20px;">Capture fabric, style, size, pattern, care instruction, and occasion details for each variant. Leave empty to fall back to default product information.</p>
                
                <div id="variants-container">
                    <!-- Default variant row -->
                    <div class="variant-row">
                        <div class="variant-inputs">
                            <div class="variant-fabric">
                                <label>Fabric:</label>
                                <input type="text" name="variantFabrics" placeholder="e.g., Cotton, Denim">
                            </div>
                            <div class="variant-style">
                                <label>Style:</label>
                                <input type="text" name="variantStyles" placeholder="e.g., Casual, Formal">
                            </div>
                            <div class="variant-size">
                                <label>Size:</label>
                                <input type="text" name="variantSizes" placeholder="e.g., S, M, L">
                            </div>
                            <div class="variant-pattern">
                                <label>Pattern:</label>
                                <input type="text" name="variantPatterns" placeholder="e.g., Solid, Striped">
                            </div>
                            <div class="variant-care">
                                <label>Care Instruction:</label>
                                <input type="text" name="variantCareInstructions" placeholder="e.g., Hand wash">
                            </div>
                            <div class="variant-occasion">
                                <label>Occasion:</label>
                                <input type="text" name="variantOccasions" placeholder="e.g., Party, Casual">
                            </div>
                        </div>
                        <button type="button" class="remove-variant-btn" onclick="removeVariant(this)">Remove</button>
                    </div>
                </div>
            </div>

            <button type="submit">Save Product</button>
        </form>
    </div>
</body>
    <script>
        // Image preview for Image 1, 2, 3, 4, 5
        document.addEventListener('DOMContentLoaded', function() {
            function setupImagePreview(inputName, previewId) {
                var imageInput = document.querySelector('input[name="' + inputName + '"]');
                var previewDiv = document.getElementById(previewId);
                if (imageInput && previewDiv) {
                    imageInput.addEventListener('change', function(e) {
                        previewDiv.innerHTML = '';
                        if (e.target.files && e.target.files[0]) {
                            var reader = new FileReader();
                            reader.onload = function(ev) {
                                var img = document.createElement('img');
                                img.src = ev.target.result;
                                img.className = 'image-preview';
                                previewDiv.appendChild(img);
                            };
                            reader.readAsDataURL(e.target.files[0]);
                        }
                    });
                }
            }
            setupImagePreview('imageFile1', 'previewImage1');
            setupImagePreview('imageFile2', 'previewImage2');
            setupImagePreview('imageFile3', 'previewImage3');
            setupImagePreview('imageFile4', 'previewImage4');
            setupImagePreview('imageFile5', 'previewImage5');
        });
</script>
</html>
