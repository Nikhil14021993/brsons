<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Product</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body { 
            font-family: Arial; 
            background: #f4f6f8; 
            margin: 0;
        }
        .form-container {
            max-width: 800px;
            background: white; 
            padding: 30px; 
            margin: 50px auto;
            border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .form-row.full {
            grid-template-columns: 1fr;
        }
        label { 
            display: block; 
            margin-top: 10px; 
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%; 
            padding: 10px; 
            margin-top: 5px;
            border: 1px solid #ddd; 
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        button { 
            margin-top: 15px; 
            padding: 12px 24px;
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .variants-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .variants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .add-variant-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        .add-variant-btn:hover {
            background: #218838;
        }
        .variant-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            align-items: end;
        }
        .variant-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            flex: 1;
        }
        .variant-size { background: #e3f2fd; }
        .variant-color { background: #f3e5f5; }
        .variant-stock { background: #e8f5e8; }
        .variant-price { background: #fff3e0; }
        .variant-discount { background: #fce4ec; }
        .variant-sku { background: #f1f8e9; }
        .remove-variant-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            height: fit-content;
        }
        .remove-variant-btn:hover {
            background: #c82333;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .variant-inputs {
                grid-template-columns: 1fr 1fr;
            }
            .variant-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
    <script>
    function toggleNewCategory(select) {
        var input = document.getElementById("newCategoryInput");
        input.style.display = (select.value === 'Other') ? 'block' : 'none';
        if (select.value === 'Other') {
            input.setAttribute("required", "true");
        } else {
            input.removeAttribute("required");
        }
    }

    function addVariant() {
        const container = document.getElementById('variants-container');
        const variantRow = document.createElement('div');
        variantRow.className = 'variant-row';
        variantRow.innerHTML = `
            <div class="variant-inputs">
                <div class="variant-size">
                    <label>Size:</label>
                    <input type="text" name="sizes" placeholder="e.g., S, M, L, XL">
                </div>
                <div class="variant-color">
                    <label>Color:</label>
                    <input type="text" name="colors" placeholder="e.g., Red, Blue">
                </div>
                <div class="variant-stock">
                    <label>Stock:</label>
                    <input type="number" name="variantStockQuantities" placeholder="Quantity">
                </div>
                <div class="variant-price">
                    <label>Retail Price:</label>
                    <input type="number" step="0.01" name="variantRetailPrices" placeholder="Price">
                </div>
                <div class="variant-discount">
                    <label>Discount %:</label>
                    <input type="number" step="0.01" name="variantDiscounts" placeholder="0.0">
                </div>
                <div class="variant-sku">
                    <label>SKU:</label>
                    <input type="text" name="skus" placeholder="Auto-generated">
                </div>
            </div>
            <button type="button" class="remove-variant-btn" onclick="removeVariant(this)">Remove</button>
        `;
        container.appendChild(variantRow);
    }

    function removeVariant(button) {
        button.parentElement.remove();
    }

    // Auto-calculate B2B price as 80% of retail price
    document.addEventListener("DOMContentLoaded", function () {
        const retailPriceInput = document.querySelector('input[name="retailPrice"]');
        const purchasePriceInput = document.querySelector('input[name="purchasePrice"]');
        const b2bPriceInput = document.querySelector('input[name="b2bPrice"]');
        
        if (retailPriceInput && b2bPriceInput) {
            retailPriceInput.addEventListener('input', function() {
                const retailPrice = parseFloat(this.value) || 0;
                // Auto-calculate B2B price as 80% of retail
                b2bPriceInput.value = (retailPrice * 0.8).toFixed(2);
                
                // Auto-calculate purchase price as 60% of retail (typical cost structure)
                if (purchasePriceInput && !purchasePriceInput.value) {
                    purchasePriceInput.value = (retailPrice * 0.6).toFixed(2);
                }
            });
        }

        // Auto-calculate B2B price when purchase price changes
        if (purchasePriceInput && b2bPriceInput) {
            purchasePriceInput.addEventListener('input', function() {
                const purchasePrice = parseFloat(this.value) || 0;
                const retailPrice = parseFloat(retailPriceInput.value) || 0;
                
                // If retail price is set, calculate B2B as 80% of retail
                if (retailPrice > 0) {
                    b2bPriceInput.value = (retailPrice * 0.8).toFixed(2);
                }
                // If only purchase price is set, suggest retail price as 1.67x purchase price
                else if (purchasePrice > 0) {
                    const suggestedRetail = (purchasePrice * 1.67).toFixed(2);
                    retailPriceInput.placeholder = `Suggested: ${suggestedRetail}`;
                }
            });
        }

        const fileInputs = [
            { input: document.querySelector('input[name="imageFile1"]'), label: "Image 1" },
            { input: document.querySelector('input[name="imageFile2"]'), label: "Image 2" },
            { input: document.querySelector('input[name="imageFile3"]'), label: "Image 3" },
            { input: document.querySelector('input[name="imageFile4"]'), label: "Image 4" },
            { input: document.querySelector('input[name="imageFile5"]'), label: "Image 5" }
        ];
        const mainPhotoSelect = document.getElementById("mainPhotoSelect");

        function updateMainPhotoOptions() {
            mainPhotoSelect.innerHTML = '<option value="">-- Select Main Photo --</option>';
            fileInputs.forEach(({ input, label }) => {
                if (input.files.length > 0) {
                    const fileName = input.files[0].name;
                    const option = document.createElement("option");
                    option.value = fileName;
                    option.textContent = `${label} (${fileName})`;
                    mainPhotoSelect.appendChild(option);
                }
            });
        }

        fileInputs.forEach(({ input }) => {
            input.addEventListener("change", updateMainPhotoOptions);
        });
    });
    </script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-logo">Cloth Shop</div>
    <ul class="navbar-links">
      <li><a th:href="@{/}">Home</a></li>
       <!-- Show Admin button only if logged-in user type is Admin -->
    <li th:if="${session.user != null and session.user.type == 'Admin'}">
        <a th:href="@{/admin}">Admin</a>
    </li>
      <li><a th:href="@{/shop}">Shop</a></li>
      <li th:if="${session.user != null}">
  <a th:href="@{/orders}">Orders</a>
</li>
      <li><a href="#">Services</a></li>
      <li><a href="#">Pricing</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">Contact Us</a></li>
      
      <!-- Dynamic Login/Logout -->
    <li th:if="${session.user == null}"><a th:href="@{/login}">Login</a></li>
    <li th:if="${session.user != null}"><a th:href="@{/logout}">Logout</a></li>
      
    </ul>
  </nav>

    <div class="form-container">
        <h2>Add Product</h2>
        <form th:action="@{/admin/add-product}" th:object="${product}" method="post" enctype="multipart/form-data">

            <div class="form-row">
                <div>
                    <label>Category:</label>
                    <select name="selectedCategory" onchange="toggleNewCategory(this)" required>
                        <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.categoryName}"></option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <input type="text" name="newCategoryName" id="newCategoryInput" style="display:none;" placeholder="Enter new category name">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Product Name:</label>
                    <input type="text" th:field="*{productName}" required>
                </div>
                <div>
                    <label>Status:</label>
                    <select th:field="*{status}" required>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Out of Stock">Out of Stock</option>
                    </select>
                </div>
            </div>

            <div class="form-row full">
                <div>
                    <label>Description:</label>
                    <textarea th:field="*{description}" placeholder="Enter product description..."></textarea>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Retail Price:</label>
                    <input type="number" step="0.01" th:field="*{retailPrice}" required>
                </div>
                <div>
                    <label>Purchase Price:</label>
                    <input type="number" step="0.01" th:field="*{purchasePrice}" placeholder="Cost price from supplier">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>B2B Price:</label>
                    <input type="number" step="0.01" th:field="*{b2bPrice}" placeholder="Auto-calculated as 80% of retail">
                </div>
                <div>
                    <label>Discount (%):</label>
                    <input type="number" step="0.01" th:field="*{discount}" placeholder="0.0">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Stock Quantity:</label>
                    <input type="number" th:field="*{stockQuantity}" placeholder="0">
                </div>
                <div>
                    <label>Image 1 (Mandatory):</label>
                    <input type="file" name="imageFile1" accept="image/*" required>
                </div>
            </div>

            <!-- Pricing Information -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #17a2b8;">
                <h4 style="margin: 0 0 10px 0; color: #17a2b8;">
                    <i class="fas fa-info-circle"></i> Pricing Structure Guide
                </h4>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                    <li><strong>Purchase Price:</strong> Cost price from supplier (typically 60% of retail price)</li>
                    <li><strong>Retail Price:</strong> Selling price to end customers</li>
                    <li><strong>B2B Price:</strong> Wholesale price for business customers (auto-calculated as 80% of retail)</li>
                    <li><strong>Profit Margin:</strong> Retail price should be at least 1.67x purchase price for healthy margins</li>
                </ul>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 2:</label>
                    <input type="file" name="imageFile2" accept="image/*">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 3:</label>
                    <input type="file" name="imageFile3" accept="image/*">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 4:</label>
                    <input type="file" name="imageFile4" accept="image/*">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label>Image 5:</label>
                    <input type="file" name="imageFile5" accept="image/*">
                </div>
                <div>
                    <label>Main Photo:</label>
                    <select name="mainPhoto" id="mainPhotoSelect" required>
                        <option value="">-- Select Main Photo --</option>
                    </select>
                </div>
            </div>

            <!-- Product Variants Section -->
            <div class="variants-section">
                <div class="variants-header">
                    <h3>Product Variants</h3>
                    <button type="button" class="add-variant-btn" onclick="addVariant()">Add Another Variant</button>
                </div>
                <p style="color: #666; margin-bottom: 20px;">Add different sizes, colors, and pricing for this product. Leave empty to use default product values.</p>
                
                <div id="variants-container">
                    <!-- Default variant row -->
                    <div class="variant-row">
                        <div class="variant-inputs">
                            <div class="variant-size">
                                <label>Size:</label>
                                <input type="text" name="sizes" placeholder="e.g., S, M, L, XL">
                            </div>
                            <div class="variant-color">
                                <label>Color:</label>
                                <input type="text" name="colors" placeholder="e.g., Red, Blue">
                            </div>
                            <div class="variant-stock">
                                <label>Stock:</label>
                                <input type="number" name="variantStockQuantities" placeholder="Quantity">
                            </div>
                            <div class="variant-price">
                                <label>Retail Price:</label>
                                <input type="number" step="0.01" name="variantRetailPrices" placeholder="Price">
                            </div>
                            <div class="variant-discount">
                                <label>Discount %:</label>
                                <input type="number" step="0.01" name="variantDiscounts" placeholder="0.0">
                            </div>
                            <div class="variant-sku">
                                <label>SKU:</label>
                                <input type="text" name="skus" placeholder="Auto-generated">
                            </div>
                        </div>
                        <button type="button" class="remove-variant-btn" onclick="removeVariant(this)">Remove</button>
                    </div>
                </div>
            </div>

            <button type="submit">Save Product</button>
        </form>
    </div>
</body>
</html>
