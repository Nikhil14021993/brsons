@GetMapping("/cart")
public String viewCart(Principal principal, Model model) {
    if (principal == null) {
        return "redirect:/login";
    }

    User user = userRepository.findByEmail(principal.getName());
    AddToCart cart = cartRepository.findByUserId(user.getId()).orElse(null);

    List<Product> productsInCart = new ArrayList<>();
    if (cart != null && cart.getProductIds() != null) {
        for (Long pid : cart.getProductIds()) {
            productRepository.findById(pid).ifPresent(productsInCart::add);
        }
    }

    model.addAttribute("cartProducts", productsInCart);
    return "cart-view";
}
